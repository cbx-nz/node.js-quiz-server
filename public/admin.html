<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Server Admin Panel - CBX Activity</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      margin-bottom: 30px;
      text-align: center;
    }

    .header h1 {
      color: #333;
      margin-bottom: 10px;
    }

    .header p {
      color: #666;
      font-size: 14px;
    }

    .admin-section {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
    }

    .admin-section h2 {
      color: #333;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #667eea;
    }

    .input-group {
      margin-bottom: 20px;
    }

    .input-group label {
      display: block;
      color: #555;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .input-group input {
      width: 100%;
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.3s;
    }

    .input-group input:focus {
      outline: none;
      border-color: #667eea;
    }

    .input-group textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 14px;
      font-family: inherit;
      min-height: 80px;
      transition: border-color 0.3s;
    }

    .input-group textarea:focus {
      outline: none;
      border-color: #667eea;
    }

    .btn {
      background: #667eea;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn:hover {
      background: #5568d3;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .btn-danger {
      background: #dc3545;
    }

    .btn-danger:hover {
      background: #c82333;
    }

    .btn-secondary {
      background: #6c757d;
    }

    .btn-secondary:hover {
      background: #5a6268;
    }

    .ip-list {
      margin-top: 20px;
    }

    .ip-item {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-left: 4px solid #dc3545;
    }

    .ip-info {
      flex: 1;
    }

    .ip-address {
      font-weight: 600;
      color: #333;
      font-size: 16px;
      margin-bottom: 5px;
    }

    .ip-reason {
      color: #666;
      font-size: 14px;
      margin-bottom: 3px;
    }

    .ip-date {
      color: #999;
      font-size: 12px;
    }

    .status-message {
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: none;
    }

    .status-message.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .status-message.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .status-message.info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }

    .empty-state {
      text-align: center;
      color: #999;
      padding: 40px;
      font-style: italic;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 25px;
      border-radius: 12px;
      color: white;
      text-align: center;
    }

    .stat-value {
      font-size: 42px;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .stat-label {
      font-size: 14px;
      opacity: 0.9;
    }

    .warning-box {
      background: #fff3cd;
      border: 2px solid #ffc107;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
    }

    .warning-box h3 {
      color: #856404;
      margin-bottom: 10px;
    }

    .warning-box p {
      color: #856404;
      font-size: 14px;
      line-height: 1.6;
    }

    .button-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üîí Server Admin Panel</h1>
      <p>Manage IP bans and server security settings</p>
    </div>

    <div class="warning-box">
      <h3>‚ö†Ô∏è Security Notice</h3>
      <p>This admin panel runs on a separate port (3001) and should be protected with firewall rules. Only allow access from trusted IPs. IP bans affect all users behind the same public IP (typically entire schools).</p>
    </div>

    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-value" id="bannedCount">0</div>
        <div class="stat-label">Banned IPs</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="activeRooms">0</div>
        <div class="stat-label">Active Rooms</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="connectedUsers">0</div>
        <div class="stat-label">Connected Users</div>
      </div>
    </div>

    <div id="statusMessage" class="status-message"></div>

    <div class="admin-section">
      <h2>üö´ Add IP Ban</h2>
      <div class="input-group">
        <label for="ipAddress">IP Address</label>
        <input type="text" id="ipAddress" placeholder="e.g., 192.168.1.100 or auto-detect" />
      </div>
      <div class="input-group">
        <label for="banReason">Reason for Ban</label>
        <textarea id="banReason" placeholder="e.g., Prohibited conduct, harassment, inappropriate content, etc."></textarea>
      </div>
      <div class="input-group">
        <label for="banDuration">Ban Duration</label>
        <select id="banDuration" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px;">
          <option value="0">Permanent (no expiration)</option>
          <option value="1">1 Hour</option>
          <option value="6">6 Hours</option>
          <option value="12">12 Hours</option>
          <option value="24">24 Hours (1 Day)</option>
          <option value="72">72 Hours (3 Days)</option>
          <option value="168">168 Hours (1 Week)</option>
          <option value="720">720 Hours (30 Days)</option>
          <option value="custom">Custom Duration...</option>
        </select>
      </div>
      <div class="input-group" id="customDurationGroup" style="display: none;">
        <label for="customDuration">Custom Duration (hours)</label>
        <input type="number" id="customDuration" min="1" placeholder="Enter hours" />
      </div>
      <div class="button-group">
        <button class="btn" onclick="addBan()">Add Ban</button>
        <button class="btn btn-secondary" onclick="autoDetectIP()">Auto-Detect Current IP</button>
      </div>
    </div>

    <div class="admin-section">
      <h2>üìã Banned IPs</h2>
      <div id="ipList" class="ip-list">
        <div class="empty-state">No banned IPs</div>
      </div>
    </div>

    <div class="admin-section">
      <h2>üö® Ban Requests from Hosts</h2>
      <div id="banRequestsList" class="ip-list">
        <div class="empty-state">No pending ban requests</div>
      </div>
    </div>

    <div class="admin-section">
      <h2>üÜî Banned UUIDs (User IDs)</h2>
      <div id="uuidList" class="ip-list">
        <div class="empty-state">No banned UUIDs</div>
      </div>
    </div>

    <div class="admin-section">
      <h2>üõ†Ô∏è Admin Actions</h2>
      <div class="button-group">
        <button class="btn btn-secondary" onclick="exportBans()">üì• Export Ban List</button>
        <button class="btn btn-secondary" onclick="importBans()">üì§ Import Ban List</button>
        <button class="btn btn-danger" onclick="clearAllBans()">üóëÔ∏è Clear All Bans</button>
      </div>
      <input type="file" id="importFile" accept=".json" style="display: none;">
    </div>
  </div>

  <script>
    let bannedIPs = [];

    // Load banned IPs on page load
    async function loadBannedIPs() {
      try {
        const response = await fetch('/api/admin/banned-ips');
        const data = await response.json();
        bannedIPs = data.bannedIPs || [];
        updateIPList();
        updateStats();
      } catch (error) {
        showStatus('Failed to load banned IPs', 'error');
      }
    }

    // Update statistics
    async function updateStats() {
      document.getElementById('bannedCount').textContent = bannedIPs.length;
      
      try {
        const response = await fetch('/api/admin/stats');
        const stats = await response.json();
        document.getElementById('activeRooms').textContent = stats.activeRooms || 0;
        document.getElementById('connectedUsers').textContent = stats.connectedUsers || 0;
      } catch (error) {
        console.error('Failed to load stats:', error);
      }
    }

    // Auto-detect current IP
    async function autoDetectIP() {
      try {
        const response = await fetch('/api/admin/my-ip');
        const data = await response.json();
        document.getElementById('ipAddress').value = data.ip;
        showStatus(`Detected IP: ${data.ip}`, 'info');
      } catch (error) {
        showStatus('Failed to detect IP address', 'error');
      }
    }

    // Add a ban
    async function addBan() {
      const ipAddress = document.getElementById('ipAddress').value.trim();
      const reason = document.getElementById('banReason').value.trim();
      const durationSelect = document.getElementById('banDuration').value;
      let duration = 0;

      if (!ipAddress) {
        showStatus('Please enter an IP address', 'error');
        return;
      }

      if (!reason) {
        showStatus('Please enter a reason for the ban', 'error');
        return;
      }

      // Get duration value
      if (durationSelect === 'custom') {
        duration = parseInt(document.getElementById('customDuration').value) || 0;
        if (duration <= 0) {
          showStatus('Please enter a valid custom duration', 'error');
          return;
        }
      } else {
        duration = parseInt(durationSelect);
      }

      // Basic IP validation
      const ipRegex = /^(\d{1,3}\.){3}\d{1,3}$/;
      if (!ipRegex.test(ipAddress)) {
        showStatus('Invalid IP address format', 'error');
        return;
      }

      try {
        const response = await fetch('/api/admin/ban-ip', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ ip: ipAddress, reason, duration })
        });

        const result = await response.json();

        if (result.success) {
          const durationText = duration > 0 ? ` for ${duration} hours` : ' permanently';
          showStatus(`Successfully banned IP: ${ipAddress}${durationText}`, 'success');
          document.getElementById('ipAddress').value = '';
          document.getElementById('banReason').value = '';
          document.getElementById('banDuration').value = '0';
          document.getElementById('customDurationGroup').style.display = 'none';
          loadBannedIPs();
        } else {
          showStatus(result.error || 'Failed to ban IP', 'error');
        }
      } catch (error) {
        showStatus('Error adding ban', 'error');
      }
    }

    // Remove a ban
    async function removeBan(ip) {
      if (!confirm(`Remove ban for IP: ${ip}?`)) {
        return;
      }

      try {
        const response = await fetch('/api/admin/unban-ip', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ ip })
        });

        const result = await response.json();

        if (result.success) {
          showStatus(`Successfully unbanned IP: ${ip}`, 'success');
          loadBannedIPs();
        } else {
          showStatus(result.error || 'Failed to unban IP', 'error');
        }
      } catch (error) {
        showStatus('Error removing ban', 'error');
      }
    }

    // Update IP list display
    function updateIPList() {
      const ipList = document.getElementById('ipList');

      if (bannedIPs.length === 0) {
        ipList.innerHTML = '<div class="empty-state">No banned IPs</div>';
        return;
      }

      ipList.innerHTML = '';
      bannedIPs.forEach(ban => {
        const ipItem = document.createElement('div');
        ipItem.className = 'ip-item';
        
        const banDate = new Date(ban.timestamp).toLocaleString();
        
        // Check if ban has expiration
        let expirationHTML = '';
        let statusClass = '';
        if (ban.unbanDate) {
          const unbanDate = new Date(ban.unbanDate);
          const now = new Date();
          if (unbanDate > now) {
            const hoursLeft = Math.ceil((unbanDate - now) / (1000 * 60 * 60));
            expirationHTML = `<div class="ip-date" style="color: #ffc107;">‚è∞ Expires: ${unbanDate.toLocaleString()} (${hoursLeft}h left)</div>`;
            statusClass = ' style="border-left-color: #ffc107;"';
          } else {
            expirationHTML = '<div class="ip-date" style="color: #28a745;">‚úÖ Expired (will be removed on next check)</div>';
            statusClass = ' style="border-left-color: #28a745;"';
          }
        } else {
          expirationHTML = '<div class="ip-date" style="color: #dc3545;">üîí Permanent ban</div>';
        }
        
        ipItem.innerHTML = `
          <div class="ip-info">
            <div class="ip-address">üö´ ${ban.ip}</div>
            <div class="ip-reason">Reason: ${ban.reason}</div>
            <div class="ip-date">Banned: ${banDate}</div>
            ${expirationHTML}
          </div>
          <button class="btn btn-danger" onclick="removeBan('${ban.ip}')">Remove</button>
        `;
        
        ipList.appendChild(ipItem);
      });
    }

    // Export bans to JSON
    function exportBans() {
      const dataStr = JSON.stringify(bannedIPs, null, 2);
      const blob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `banned-ips-${Date.now()}.json`;
      a.click();
      URL.revokeObjectURL(url);
      showStatus('Ban list exported successfully', 'success');
    }

    // Import bans from JSON
    function importBans() {
      document.getElementById('importFile').click();
    }

    document.getElementById('importFile').addEventListener('change', async (e) => {
      const file = e.target.files[0];
      if (!file) return;

      try {
        const text = await file.text();
        const importedBans = JSON.parse(text);

        if (!Array.isArray(importedBans)) {
          showStatus('Invalid file format. Expected JSON array.', 'error');
          return;
        }

        const response = await fetch('/api/admin/import-bans', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ bans: importedBans })
        });

        const result = await response.json();

        if (result.success) {
          showStatus(`Successfully imported ${result.count} bans`, 'success');
          loadBannedIPs();
        } else {
          showStatus(result.error || 'Failed to import bans', 'error');
        }
      } catch (error) {
        showStatus('Error importing bans: ' + error.message, 'error');
      }

      e.target.value = '';
    });

    // Clear all bans
    async function clearAllBans() {
      if (!confirm('Are you sure you want to remove ALL bans? This cannot be undone.')) {
        return;
      }

      try {
        const response = await fetch('/api/admin/clear-bans', {
          method: 'POST'
        });

        const result = await response.json();

        if (result.success) {
          showStatus('All bans cleared successfully', 'success');
          loadBannedIPs();
        } else {
          showStatus(result.error || 'Failed to clear bans', 'error');
        }
      } catch (error) {
        showStatus('Error clearing bans', 'error');
      }
    }

    // Show status message
    function showStatus(message, type) {
      const statusMessage = document.getElementById('statusMessage');
      statusMessage.textContent = message;
      statusMessage.className = `status-message ${type}`;
      statusMessage.style.display = 'block';
      
      setTimeout(() => {
        statusMessage.style.display = 'none';
      }, 5000);
    }

    // Load ban requests
    async function loadBanRequests() {
      try {
        const response = await fetch('/api/admin/ban-requests');
        const data = await response.json();
        const requestsList = document.getElementById('banRequestsList');
        
        if (!data.banRequests || data.banRequests.length === 0) {
          requestsList.innerHTML = '<div class="empty-state">No pending ban requests</div>';
          return;
        }
        
        requestsList.innerHTML = '';
        data.banRequests.forEach(request => {
          const requestDiv = document.createElement('div');
          requestDiv.className = 'ip-item';
          requestDiv.style.borderLeft = '4px solid #ffc107';
          requestDiv.style.background = '#fffbf0';
          
          const timestamp = new Date(request.timestamp).toLocaleString();
          const displayUUID = request.uuid && request.uuid !== 'unknown' ? request.uuid.substring(0, 8) + '...' : 'N/A';
          const displayIP = request.playerIP && request.playerIP !== 'unknown' ? request.playerIP : 'N/A';
          
          requestDiv.innerHTML = `
            <div class="ip-info">
              <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                <div>
                  <strong style="font-size: 18px; color: #333;">üë§ ${request.playerName}</strong>
                  <div style="margin-top: 6px;">
                    <span style="color: #666; font-size: 13px; background: #f0f0f0; padding: 3px 8px; border-radius: 4px; margin-right: 8px;">üÜî UUID: ${displayUUID}</span>
                    <span style="color: #666; font-size: 13px; background: #f0f0f0; padding: 3px 8px; border-radius: 4px;">üåê IP: ${displayIP}</span>
                  </div>
                </div>
                <span style="color: #999; font-size: 12px; white-space: nowrap;">${timestamp}</span>
              </div>
              <div style="background: #fff; padding: 10px; border-radius: 6px; margin-bottom: 10px; border: 1px solid #e0e0e0;">
                <strong style="color: #d32f2f;">Reason:</strong> 
                <div style="color: #555; margin-top: 4px;">${request.reason}</div>
              </div>
              <div style="color: #888; font-size: 13px; margin-bottom: 12px;">
                <strong>Requested by:</strong> ${request.requestedBy || 'Unknown'} ‚Ä¢ <strong>Room:</strong> ${request.roomCode || 'N/A'}
              </div>
              <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                <button class="btn" style="background: #28a745; flex: 1; min-width: 120px;" onclick="approveBanRequest('${request.id}', 'uuid')">
                  ‚úÖ Ban UUID
                </button>
                <button class="btn" style="background: #ff9800; flex: 1; min-width: 120px; color: white;" onclick="approveBanRequest('${request.id}', 'ip')">
                  üö´ Ban IP
                </button>
                <button class="btn" style="background: #dc3545; flex: 1; min-width: 120px; color: white;" onclick="approveBanRequest('${request.id}', 'both')">
                  ‚õî Ban Both
                </button>
                <button class="btn btn-secondary" style="flex: 1; min-width: 120px;" onclick="rejectBanRequest('${request.id}')">
                  ‚ùå Reject
                </button>
              </div>
            </div>
          `;
          
          requestsList.appendChild(requestDiv);
        });
      } catch (error) {
        console.error('Error loading ban requests:', error);
      }
    }

    // Load banned UUIDs
    async function loadBannedUUIDs() {
      try {
        const response = await fetch('/api/admin/banned-uuids');
        const data = await response.json();
        const uuidList = document.getElementById('uuidList');
        
        if (!data.bannedUUIDs || data.bannedUUIDs.length === 0) {
          uuidList.innerHTML = '<div class="empty-state">No banned UUIDs</div>';
          return;
        }
        
        uuidList.innerHTML = '';
        data.bannedUUIDs.forEach(ban => {
          const banDiv = document.createElement('div');
          banDiv.className = 'ip-item';
          
          const bannedDate = new Date(ban.bannedAt).toLocaleString();
          
          let unbanDateHTML = '';
          if (ban.unbanDate) {
            const unbanDate = new Date(ban.unbanDate);
            const now = new Date();
            if (unbanDate > now) {
              const hoursLeft = Math.ceil((unbanDate - now) / (1000 * 60 * 60));
              unbanDateHTML = `
                <div style="color: #28a745; margin-top: 4px; font-size: 12px;">
                  <strong>‚è±Ô∏è Auto-unban:</strong> ${unbanDate.toLocaleString()} (in ${hoursLeft} hours)
                </div>
              `;
            } else {
              unbanDateHTML = `
                <div style="color: #dc3545; margin-top: 4px; font-size: 12px;">
                  <strong>‚è±Ô∏è Expired:</strong> ${unbanDate.toLocaleString()} (should auto-remove)
                </div>
              `;
            }
          }
          
          banDiv.innerHTML = `
            <div class="ip-info">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                  <strong style="font-size: 16px;">${ban.playerName || 'Unknown Player'}</strong>
                  <div style="color: #666; font-size: 13px; margin-top: 4px;">
                    UUID: <code style="background: #f0f0f0; padding: 2px 6px; border-radius: 4px;">${ban.uuid}</code>
                  </div>
                </div>
                <button class="btn btn-secondary" style="background: #dc3545;" onclick="unbanUUID('${ban.uuid}')">
                  üîì Unban
                </button>
              </div>
              <div style="color: #555; margin-top: 8px;">
                <strong>Reason:</strong> ${ban.reason}
              </div>
              <div style="color: #999; font-size: 12px; margin-top: 4px;">
                Banned: ${bannedDate}
              </div>
              ${unbanDateHTML}
            </div>
          `;
          
          uuidList.appendChild(banDiv);
        });
      } catch (error) {
        console.error('Error loading banned UUIDs:', error);
      }
    }

    // Approve ban request
    async function approveBanRequest(requestId, banType = 'uuid') {
      const messages = {
        uuid: 'Ban this user\'s UUID? They can still access from other browsers.',
        ip: 'Ban this IP address? They can still access from other devices/networks.',
        both: 'Ban BOTH UUID and IP? This is the most restrictive option.'
      };
      
      if (!confirm(messages[banType] || messages.uuid)) {
        return;
      }
      
      // Ask for unban date if banning UUID or both
      let unbanDate = null;
      if (banType === 'uuid' || banType === 'both') {
        const wantsUnbanDate = confirm('Do you want to set an automatic unban date? (Click Cancel for permanent ban)');
        if (wantsUnbanDate) {
          const hours = prompt('Enter number of hours until automatic unban (e.g., 24 for 1 day, 168 for 1 week):');
          if (hours && !isNaN(hours) && hours > 0) {
            unbanDate = Date.now() + (parseFloat(hours) * 60 * 60 * 1000);
          }
        }
      }
      
      try {
        const response = await fetch('/api/admin/approve-ban-request', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ requestId, banType, unbanDate })
        });
        
        const result = await response.json();
        if (result.success) {
          showStatus(`Ban request approved (${banType.toUpperCase()})`, 'success');
          loadBanRequests();
          loadBannedUUIDs();
          loadBannedIPs();
        } else {
          showStatus(result.error || 'Failed to approve ban', 'error');
        }
      } catch (error) {
        showStatus('Error approving ban request', 'error');
      }
    }

    // Reject ban request
    async function rejectBanRequest(requestId) {
      if (!confirm('Reject this ban request?')) {
        return;
      }
      
      try {
        const response = await fetch('/api/admin/reject-ban-request', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ requestId })
        });
        
        const result = await response.json();
        if (result.success) {
          showStatus('Ban request rejected', 'success');
          loadBanRequests();
        } else {
          showStatus(result.error || 'Failed to reject ban', 'error');
        }
      } catch (error) {
        showStatus('Error rejecting ban request', 'error');
      }
    }

    // Unban UUID
    async function unbanUUID(uuid) {
      if (!confirm(`Unban UUID ${uuid.substring(0, 8)}...? This will allow the user to rejoin.`)) {
        return;
      }
      
      try {
        const response = await fetch('/api/admin/unban-uuid', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ uuid })
        });
        
        const result = await response.json();
        if (result.success) {
          showStatus('UUID unbanned successfully', 'success');
          loadBannedUUIDs();
        } else {
          showStatus(result.error || 'Failed to unban UUID', 'error');
        }
      } catch (error) {
        showStatus('Error unbanning UUID', 'error');
      }
    }

    // Load banned IPs on page load
    loadBannedIPs();
    loadBanRequests();
    loadBannedUUIDs();

    // Refresh stats and lists every 10 seconds
    setInterval(() => {
      updateStats();
      loadBanRequests();
    }, 10000);

    // Show/hide custom duration input
    document.getElementById('banDuration').addEventListener('change', function() {
      const customGroup = document.getElementById('customDurationGroup');
      if (this.value === 'custom') {
        customGroup.style.display = 'block';
      } else {
        customGroup.style.display = 'none';
      }
    });
  </script>
</body>
</html>
